twitter_renderer
================

twitter_renderer

ziel ist ein htmlwidget von twitter mit ersetzten urls.
das widget wird vom twitter script erzeugt

die urls werden auf einen reverse proxy geleitet.
das problem ist diesen proxy gegen missbrauch abzusichern
alternativ könnten die elemente gelande und durch eigene urls ersetzt werden
links werden mit "sie verlassen jetzt ... versehen" leave.to?url=http://www.web.de

Twitter
<blockquote class="twitter-tweet" lang="de"><p>Såre scener fra et liv med bror med Downs -<a href="http://t.co/DycIyYZOxD">http://t.co/DycIyYZOxD</a> <a href="https://twitter.com/hashtag/sorteringssamfunnet?src=hash">#sorteringssamfunnet</a> <a href="https://twitter.com/hashtag/debatten?src=hash">#debatten</a> <a href="https://twitter.com/hashtag/nrkdebatt?src=hash">#nrkdebatt</a> <a href="https://twitter.com/hashtag/downs?src=hash">#downs</a> <a href="http://t.co/s7RvfVQicu">pic.twitter.com/s7RvfVQicu</a></p>&mdash; Geir Olav Drablos (@godrablos) <a href="https://twitter.com/godrablos/status/510143515758964736">11. September 2014</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

Facebook
<div id="fb-root"></div> <script>(function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "//connect.facebook.net/de_DE/all.js#xfbml=1"; fjs.parentNode.insertBefore(js, fjs); }(document, 'script', 'facebook-jssdk'));</script>
<div class="fb-post" data-href="https://www.facebook.com/HofButenland/posts/728570373847553" data-width="466"><div class="fb-xfbml-parse-ignore"><a href="https://www.facebook.com/HofButenland/posts/728570373847553">Beitrag</a> von <a href="https://www.facebook.com/HofButenland">Hof Butenland</a>.</div></div>


Google Plus
<!-- Place this tag in your head or just before your close body tag. -->
<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
<!-- Place this tag where you want the widget to render. -->
<div class="g-post" data-href="https://plus.google.com/102860501900098846931/posts/BTZNZjjjTZC"></div>
<!-- <div class="g-post" data-href="https://plus.google.com/102860501900098846931/posts/Qnfx7ECzooW"></div> -->

MR
<script>!function(a,b,c,d,e,f,g,h,i,j,k){h=a[d]=a[d]||{},h.ui=h.ui||[],i=a[e]=a[e]||{},i[f]||(j=b.getElementsByTagName(c)[0],k=b.createElement(c),k.src="//platform.massrelevance.com/js/massrel.js",j.parentNode.insertBefore(k,j),i[f]=function(){h.ui.push([].slice.call(arguments))}),i[f]("load",{el:b.getElementById(g)})}(window,document,"script","massrel","spredfast","exp","mr-space_heute_de");</script>

MR heuteJ
<div class="mr-space" id="mr-space_heutejournal_team" data-space-id="zdf/heutejournal_team" style="min-height: 500px;"></div>
<script>!function(a,b,c,d,e,f,g,h,i,j,k){h=a[d]=a[d]||{},h.ui=h.ui||[],i=a[e]=a[e]||{},i[f]||(j=b.getElementsByTagName(c)[0],k=b.createElement(c),k.src="//platform.massrelevance.com/js/massrel.js",j.parentNode.insertBefore(k,j),i[f]=function(){h.ui.push([].slice.call(arguments))}),i[f]("load",{el:b.getElementById(g)})}(window,document,"script","massrel","spredfast","exp","mr-space_heutejournal_team");</script>

<div class="mr-space" id="mr-space_heutejournal_team" data-space-id="zdf/heutejournal_team" style="height: 100%;"></div>
<script>!function(a,b,c,d,e,f,g,h,i,j,k){h=a[d]=a[d]||{},h.ui=h.ui||[],i=a[e]=a[e]||{},i[f]||(j=b.getElementsByTagName(c)[0],k=b.createElement(c),k.src="//platform.massrelevance.com/js/massrel.js",j.parentNode.insertBefore(k,j),i[f]=function(){h.ui.push([].slice.call(arguments))}),i[f]("load",{el:b.getElementById(g)})}(window,document,"script","massrel","spredfast","exp","mr-space_heutejournal_team");</script>


Vimdeo
<iframe src="//player.vimeo.com/video/57974967" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>

YT
<iframe width="560" height="315" src="//www.youtube.com/embed/UDAXuWANp5c" frameborder="0" allowfullscreen></iframe>



NEO
http://cm2-prod-pre.zdf.de/ZDFpreview/zdfportal/blob/36041990/5/data.png
http://zdf.massrel.io/neo-magazin-royale/
<div class="mr-space" id="mr-space_neo-magazin-royale" data-space-id="zdf/neo-magazin-royale" style="min-height: 1080px;"></div>
<script>!function(a,b,c,d,e,f,g,h,i,j,k){h=a[d]=a[d]||{},h.ui=h.ui||[],i=a[e]=a[e]||{},i[f]||(j=b.getElementsByTagName(c)[0],k=b.createElement(c),k.src="//platform.massrelevance.com/js/massrel.js",j.parentNode.insertBefore(k,j),i[f]=function(){h.ui.push([].slice.call(arguments))}),i[f]("load",{el:b.getElementById(g)})}(window,document,"script","massrel","spredfast","exp","mr-space_neo-magazin-royale");</script>


berlindirekt
<iframe src="http://zdf.massrel.io/berlin-direkt" width="364px" height="410px" frameborder="0" scrolling="auto" marginheight="0px" marginwidth="0px" allowfullscreen></iframe>

<div class="mr-space" id="mr-space_berlin-direkt" data-space-id="zdf/berlin-direkt" style="min-height: 410px;"></div>
<script>!function(a,b,c,d,e,f,g,h,i,j,k){h=a[d]=a[d]||{},h.ui=h.ui||[],i=a[e]=a[e]||{},i[f]||(j=b.getElementsByTagName(c)[0],k=b.createElement(c),k.src="//platform.massrelevance.com/js/massrel.js",j.parentNode.insertBefore(k,j),i[f]=function(){h.ui.push([].slice.call(arguments))}),i[f]("load",{el:b.getElementById(g)})}(window,document,"script","massrel","spredfast","exp","mr-space_berlin-direkt");</script>


CL_mobil
<div class="mr-space" id="mr-space_cl_final_mobil" data-space-id="zdf/cl_final_mobil" style="min-height: 800px;"></div>
<script>!function(a,b,c,d,e,f,g,h,i,j,k){h=a[d]=a[d]||{},h.ui=h.ui||[],i=a[e]=a[e]||{},i[f]||(j=b.getElementsByTagName(c)[0],k=b.createElement(c),k.src="//platform.massrelevance.com/js/massrel.js",j.parentNode.insertBefore(k,j),i[f]=function(){h.ui.push([].slice.call(arguments))}),i[f]("load",{el:b.getElementById(g)})}(window,document,"script","massrel","spredfast","exp","mr-space_cl_final_mobil");</script>

CL_sport_start
<div class="mr-space" id="mr-space_cl_final" data-space-id="zdf/cl_final" style="min-height: 500px;"></div>
<script>!function(a,b,c,d,e,f,g,h,i,j,k){h=a[d]=a[d]||{},h.ui=h.ui||[],i=a[e]=a[e]||{},i[f]||(j=b.getElementsByTagName(c)[0],k=b.createElement(c),k.src="//platform.massrelevance.com/js/massrel.js",j.parentNode.insertBefore(k,j),i[f]=function(){h.ui.push([].slice.call(arguments))}),i[f]("load",{el:b.getElementById(g)})}(window,document,"script","massrel","spredfast","exp","mr-space_cl_final");</script>


##Live

NEO
4695a46e2d3fb6579ed3587c6d6882b61ded2e64
http://www.zdf.de/neo-magazin-mit-jan-boehmermann/neo-magazin-fanmeile-36922968.html
Neu: 5be2823d16c86d455dff7e7b8c4b58c8b08e3d80

Berlin Direkt
acb994a5f28413c296c551a3d8ba0023e3742a2e
http://www.zdf.de/berlin-direkt/twittern-sie-berlin-direkt-die-meinung-21765160.html

Heute+
e2728800d782491dee6623f8011761e7c520cc55
http://www.zdf.de/heute-plus/heute-plus-5989324.html


CL_mobil
d61a424a8989ac9381753b99a76fc97cbb50b343

CL_sport
b02e9d27fa3e3afc02fce5d6a1ddc204b2b5d1de

var ids = ["4695a46e2d3fb6579ed3587c6d6882b61ded2e64","acb994a5f28413c296c551a3d8ba0023e3742a2e","e2728800d782491dee6623f8011761e7c520cc55"]
ids.indexOf(doc._id)

Sync
curl -X POST -H "Content-Type: application/json" -d '{"source":"http://wmaiz-v-sofa02.dbc.zdf.de:5984/twr", 
"target":"http://wmaiz-v-sofa01.dbc.zdf.de:5984/twr", "doc_ids":["d61a424a8989ac9381753b99a76fc97cbb50b343"] }' http://wmaiz-v-sofa01.dbc.zdf.de:5984/_replicate

24734482
25441046


TODO
css erstellen Done

Im Picker alten eintrag auswählbar machen ohne identischen quelltext einfügen zu müssen Done
Recent ID/Name Vie/Liste erstellen Done

auto refresh screenshot
	id bleibt ntürlich gleich, es wird nur der anhang geändert
	bei neuem content ID neue ID. änderungen immer über picker


Bearbeiten einer alten ID über den picker ermöglichen. Rejected


Langfristig Renderer komplett trennen.
	Im Picker wird ein Auftrag erzeugt und in DB gespeichert.
	Der Renderer überwacht den Changes Feed/listViewOpen und rendert nach einander.
	Der P12 Script im HTML Embeddcode muss generisch sein, da beim Speichern die Anzahl der Bilder nicht fest steht.
	Nachteil keine Vorschau oder 2 wege (mit und ohne vorschau implementieren)
	Oder nicht so weit treiben und im Picker auf ChangesFeed warten und dann Vorschau anzeigen.


Live schalten Funktion
	auf sofa02 ausgewählte (aktivierte) Elemente auf sofa01 synchronisieren. picker auf sofa01 so aufbauen das er den auf sofa02 nutzt
	auf 01 im prinzip alles ausbauen. live und dev arbeiten(rendern) auf 02. dafür unterschiedliche design docs benutzen. 
	dev auf merlin umziehen.

####
render auftrag speichern damit er für url=int oder url=live gerendert werden kann. 
speichern wärend render deaktivieren

renderauftrag abspeichern mit feld für targets=c1/c2
dienst auf c2 prüft auf renderaufträge und erzeugt einmal bilder und für jedes ziel css/html/js dateien.

####


ziel:
 neue funktionen live verfügbar machen
 alte inhalte müssen erreichbar bleiben. (alte docs auf sofa01)
 entwicklungsfähigkeit muss bleiben

 sofa1 spielt weiter aus
 picker auf sofa02 umleiten. 02 rendert und synct auf 01
 
 live und testing als desiogn doc einsetzen


Ablauf:
Vor die Pickerschnittstelle:
	Live stelle Button: doc.status = "live", replicate mit filter auf 01
	Zurückziehen:		doc.status = "depub", doc auf 01 löschen
	playouturl ändern


curl -X DELETE http://s2:5984/twr/f4a7e6e2567107a950d86d74af9eea8b41904090?rev=9-c02092f2442ebdff4d7cd7e0973ce8ac

curl -X POST -H "Content-Type: application/json" -d '{"source":"http://s2:5984/twr", "target":"http://s2:5984/twr2", "doc_ids":["f4a7e6e2567107a950d86d74af9eea8b41904090"], "filter":"tweetrenderdb/livefilter", "query_params": {"status":"live"} }' http://s2:5984/_replicate




Flow
====

applogic 	on "applogic.renderImageRequest" 		-> applogic  	emit "datastore.getDocRequest"

datastore 	on "datastore.getDocRequest"			-> datastore 	emit "datastore.docFound"
													-> datastore 	emit "datastore.newDocCreated"

datastore	on "datastore.docFound"					-> datastore 	emit "applogic.CodeComplete"



applogic 	on "datastore.newDocCreated"			-> datastore 	emit "datastore.saveScriptRequest"

datastore 	on "datastore.saveScriptRequest"		-> datastore 	emit "datastore.saveOrigEmbedCodeRequest"

datastore	on "datastore.saveOrigEmbedCodeRequest" -> datastore 	emit "datastore.saveHtmlRequest"

datastore	on "datastore.saveHtmlRequest"			-> datastore 	emit "datastore.saveXmlRequest"

datastore	on "datastore.saveXmlRequest"			-> datastore 	emit "datastore.saveScriptCompleted"


applogic	on "datastore.saveScriptCompleted"		-> applogic 	emit "applogic.renderImageCompleted"


applogic 	on "applogic.renderImageCompleted"		-> datastore 	emit "datastore.saveImageRequest"

datastore	on "datastore.saveImageRequest"			-> datastore 	emit "datastore.saveImageCompleted"

applogic	on "datastore.saveImageCompleted"		-> applogic 	emit "applogic.CodeComplete"


app 		on "applogic.CodeComplete"				-> socket 		emit "CodeComplete"

